<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <meta name="theme-color" content="#4a8bff" />
    <title>Teacher Zhang| ä»Šå¤©è¿‡å¾—å¼€å¿ƒå—</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            -webkit-tap-highlight-color: transparent;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            user-select: none;
            box-sizing: border-box;
        }
        
        html, body {
            width: 100%;
            height: 100%;
            overflow: hidden;
            background: white;
            font-family: Arial, sans-serif;
            position: fixed;
            top: 0;
            left: 0;
        }

        #modal {
            position: fixed;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%) scale(0.7);
            width: 85vw;
            max-width: 320px;
            padding: 25px 20px;
            background: white;
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.15);
            opacity: 0;
            animation: modalIn 0.4s ease-out forwards;
            text-align: center;
            z-index: 99999;
            border: 1px solid rgba(0,0,0,0.08);
        }

        @keyframes modalIn {
            0% { opacity: 0; transform: translate(-50%, -50%) scale(0.5); }
            70% { opacity: 1; transform: translate(-50%, -50%) scale(1.05); }
            100% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
        }

        #modal h2 {
            color: #333;
            margin-bottom: 12px;
            font-weight: 600;
            font-size: 22px;
        }

        #modal p {
            color: #666;
            margin-bottom: 20px;
            line-height: 1.5;
            font-size: 16px;
        }

        .modal-buttons {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .modal-btn {
            padding: 14px 24px;
            border: none;
            font-size: 16px;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.2s ease;
            font-weight: 600;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            min-height: 48px;
        }

        .btn-primary {
            background: #4a8bff;
            color: white;
        }

        .btn-primary:active {
            background: #3c7af5;
            transform: scale(0.98);
        }

        .btn-secondary {
            background: #f8f9fa;
            color: #555;
            border: 1px solid #e0e0e0;
        }

        .btn-secondary:active {
            background: #e9ecef;
            transform: scale(0.98);
        }

        .popup {
            position: absolute;
            padding: 10px 16px;
            border-radius: 12px;
            font-size: 14px;
            white-space: nowrap;
            box-shadow: 0 5px 15px rgba(0,0,0,0.12);
            transform-origin: center;
            opacity: 0;
            animation: popupIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
            cursor: pointer;
            z-index: 100;
            font-weight: 500;
            max-width: 70vw;
            overflow: hidden;
            text-overflow: ellipsis;
            min-height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: opacity 0.4s ease;
        }

        .popup.fade-out {
            opacity: 0;
        }

        @keyframes popupIn {
            0% { transform: scale(0.4) rotate(-8deg); opacity: 0; }
            60% { transform: scale(1.1) rotate(3deg); opacity: 1; }
            100% { transform: scale(1) rotate(0deg); opacity: 1; }
        }

        .pink { background: #ffd7e5; color: #b1004d; }
        .yellow { background: #fff6c7; color: #8a6d00; }
        .blue { background: #d5eaff; color: #004a9f; }
        .green { background: #dbffe2; color: #0b7a2b; }
        .purple { background: #e8d7ff; color: #5a2d9c; }
        .orange { background: #ffe7d5; color: #b35200; }
        .cyan { background: #d5f9ff; color: #006a7a; }
        .coral { background: #ffd5d5; color: #a10000; }

        .decoration {
            position: absolute;
            border-radius: 50%;
            opacity: 0.04;
            z-index: 0;
            background: #4a8bff;
        }

        #final-message {
            position: fixed;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%) scale(0);
            width: 85vw;
            max-width: 320px;
            padding: 30px 20px;
            background: white;
            border-radius: 20px;
            box-shadow: 0 15px 50px rgba(0,0,0,0.2);
            text-align: center;
            z-index: 99999;
            opacity: 0;
            transition: all 0.3s ease;
        }

        #final-message.show {
            opacity: 1;
            transform: translate(-50%, -50%) scale(1);
        }

        #final-message h2 {
            color: #333;
            margin-bottom: 15px;
            font-size: 24px;
        }

        #final-message p {
            color: #666;
            margin-bottom: 25px;
            line-height: 1.5;
        }

        .heart {
            color: #ff4d6d;
            font-size: 36px;
            margin: 15px 0;
            animation: heartbeat 1.2s ease infinite;
        }

        @keyframes heartbeat {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        @keyframes popupOut {
            0% { transform: scale(1) rotate(0deg); opacity: 1; }
            100% { transform: scale(0) rotate(10deg); opacity: 0; }
        }
        
        @keyframes modalOut {
            0% { transform: translate(-50%, -50%) scale(1); opacity: 1; }
            100% { transform: translate(-50%, -50%) scale(0.7); opacity: 0; }
        }
    </style>
</head>
<body>
    <div id="modal">
        <h2>âœ¨ æ¸©é¦¨é—®å€™ âœ¨</h2>
        <p>è¿™é‡Œæœ‰ä¸€ä»½ç‰¹åˆ«çš„é—®å€™ï¼Œå¸Œæœ›å®ƒèƒ½ç»™ä½ å¸¦æ¥ä¸€ä¸æ¸©æš–å’Œå¿«ä¹ï¼</p>
        <div class="modal-buttons">
            <button class="modal-btn btn-primary" onclick="startExperience()">æ‰“å¼€é—®å€™</button>
            <button class="modal-btn btn-secondary" onclick="closeModal()">ç¨åå†è¯´</button>
        </div>
    </div>

    <div id="final-message">
        <h2>æ„Ÿè°¢ä½ çš„åœç•™ï¼</h2>
        <p>å¸Œæœ›è¿™äº›å°å°çš„é—®å€™èƒ½ç»™ä½ å¸¦æ¥ä¸€ä¸æ¸©æš–å’Œå¿«ä¹ã€‚</p>
        <div class="heart">â¤ï¸</div>
        <p>æ— è®ºä»Šå¤©è¿‡å¾—å¦‚ä½•ï¼Œè¯·è®°å¾—å¥½å¥½ç…§é¡¾è‡ªå·±ã€‚</p>
        <button class="modal-btn btn-primary" onclick="location.reload()">å†æ¬¡ä½“éªŒ</button>
    </div>

    <!-- èƒŒæ™¯éŸ³ä¹ -->
    <audio id="bgMusic" loop playsinline>
        <source src="manbo.MP3" type="audio/mpeg">
        æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒéŸ³é¢‘å…ƒç´ ã€‚
    </audio>

    <script>
        // å¤§å¹…æ‰©å……çš„é—®å€™è¯­åº“ï¼ˆ80æ¡ç®€çŸ­æ¸©æš–é—®å€™ï¼‰
        const greetings = [
            "ä»Šå¤©è¿‡å¾—å¼€å¿ƒå—ï¼Ÿ", "è®°å¾—å¾®ç¬‘å“¦ï¼", "ä½ çœŸçš„å¾ˆæ£’ï¼", "ä¿æŒç§¯æå¿ƒæ€ï¼", "ä¸€åˆ‡éƒ½ä¼šå¥½èµ·æ¥çš„ï¼",
            "ä½ å€¼å¾—è¢«æ¸©æŸ”ä»¥å¾…ï¼", "ä»Šå¤©ä¹Ÿè¦åŠ æ²¹å‘€ï¼", "ä¸–ç•Œå› ä½ è€Œç¾ä¸½ï¼", "ä¿æŒå¥½å¿ƒæƒ…ï¼", "ä½ æ˜¯æœ€ç‰¹åˆ«çš„ï¼",
            "è®°å¾—å¥½å¥½ä¼‘æ¯ï¼", "ä»Šå¤©æœ‰å¥½äº‹å‘ç”Ÿï¼", "ä¿æŒå¯çˆ±ï¼", "ä½ åšå¾—å¾ˆå¥½ï¼", "æ˜å¤©ä¼šæ›´å¥½ï¼",
            "è®°å¾—å¤šå–æ°´å“¦ï¼", "è¦å¥½å¥½ç…§é¡¾è‡ªå·±ï¼", "ä½ å¾ˆé‡è¦ï¼", "åˆ«å¤ªç´¯ç€è‡ªå·±ï¼", "ä»Šå¤©å¤©æ°”ä¸é”™ï¼",
            "è®°å¾—æŒ‰æ—¶åƒé¥­ï¼", "ä½ ç¬‘èµ·æ¥çœŸå¥½çœ‹ï¼", "ä»Šå¤©ä¹Ÿè¦çˆ±è‡ªå·±ï¼", "ä¸€åˆ‡å›°éš¾éƒ½ä¼šè¿‡å»ï¼", "ä½ è®©ä¸–ç•Œæ›´ç¾å¥½ï¼",
            "æˆ‘æ‡‚ä½ çš„æ„Ÿå— ğŸ’•", "ä½ å¹¶ä¸å­¤å• ğŸŒŸ", "æ…¢æ…¢æ¥ï¼Œä¸ç€æ€¥ â³", "ä½ å·²ç»å¾ˆæ£’äº† âœ¨", "ä¸€åˆ‡éƒ½ä¼šå¥½çš„ ğŸŒˆ",
            "å¯¹è‡ªå·±å¥½ä¸€ç‚¹ ğŸŒ¸", "ä½ å€¼å¾—è¢«çˆ± ğŸ’–", "ä¼‘æ¯ä¹Ÿæ˜¯å‰è¿› ğŸ›‹ï¸", "åšè‡ªå·±å°±å¾ˆå¥½ ğŸŒŸ", "ä½ æœ¬èº«å°±å¾ˆç¾ ğŸ’«",
            "æ˜å¤©ä¼šæ›´å¥½ ğŸŒ…", "é˜³å…‰æ€»åœ¨é£é›¨å â˜€ï¸", "åšæŒå°±æ˜¯èƒœåˆ© ğŸ†", "ç›¸ä¿¡ç¾å¥½ä¼šåˆ°æ¥ ğŸ", "ä½ æ˜¯è‡ªå·±çš„å…‰ ğŸ’¡",
            "ä¸–ç•Œå› ä½ è€Œæš– ğŸŒ", "ä»Šå¤©ä¹Ÿè¦å¼€å¿ƒ ğŸ˜Š", "å¾®ç¬‘æ”¹å˜ä¸€åˆ‡ ğŸ˜„", "æ„Ÿæ©å½“ä¸‹æ—¶åˆ» ğŸ™", "ç”Ÿæ´»å……æ»¡æƒŠå–œ ğŸ‰",
            "ä½ æ˜¯ç‹¬ä¸€æ— äºŒçš„", "ä¿æŒå†…å¿ƒå¹³é™", "å°ç¡®å¹¸ä¹Ÿå¾ˆç¾", "ä»Šå¤©è¦çˆ±è‡ªå·±", "æ…¢æ…¢æ¥æ¯”è¾ƒå¿«",
            "ä½ è®©ç”Ÿæ´»ç¾å¥½", "è®°å¾—æ·±å‘¼å¸ ğŸŒ¬ï¸", "ä»Šå¤©è¦å¾®ç¬‘ ğŸ˜Š", "ä½ æ˜¯é‡è¦çš„", "ä¸€åˆ‡éƒ½ä¼šå¦‚æ„¿",
            "ä¿æŒå¸Œæœ› ğŸŒŸ", "ä½ æ˜¯å‹‡æ•¢çš„", "ä»Šå¤©è¦å¿«ä¹", "ä½ å¾ˆäº†ä¸èµ·", "ç»§ç»­å‰è¿› ğŸš¶â€â™‚ï¸",
            "ç›¸ä¿¡è‡ªå·±", "ä½ æ˜¯åšå¼ºçš„", "ä»Šå¤©å¾ˆæ£’äº†", "æœªæ¥å¯æœŸ", "ä¿æŒåˆå¿ƒ",
            "ä½ å¾ˆä¼˜ç§€", "ä»Šå¤©è¾›è‹¦äº†", "æ”¾æ¾ä¸€ä¸‹", "ä½ å¾ˆçè´µ", "ç»§ç»­åŠ æ²¹",
            "ä¿æŒçƒ­æƒ…", "ä½ æ˜¯æ¸©æš–çš„", "ä»Šå¤©è¿›æ­¥äº†", "ä½ å¾ˆå‡ºè‰²", "ä¿æŒå–„è‰¯",
            "ä½ æ˜¯å…‰æ˜çš„", "ä»Šå¤©æˆé•¿äº†", "ä½ å¾ˆç‹¬ç‰¹", "ä¿æŒä¹è§‚", "ä½ æ˜¯ç¾å¥½çš„"
        ];

        let popupInterval;
        let isFinalMessageShown = false;
        let experienceStartTime = 0;
        let activePopups = [];
        const MAX_POPUPS = 35; // èˆ’é€‚é˜ˆå€¼
        let usedGreetings = []; // è®°å½•å·²ä½¿ç”¨çš„é—®å€™
        let greetingCycleCount = 0; // é—®å€™è¯­å¾ªç¯è®¡æ•°
        let audioKeepAliveInterval; // iOSéŸ³é¢‘ä¿æ´»å®šæ—¶å™¨

        // éŸ³ä¹æ§åˆ¶
        const bgMusic = document.getElementById('bgMusic');
        let musicPlaying = false;

        // iOSéŸ³é¢‘ä¿æ´»åŠŸèƒ½
        function startAudioKeepAlive() {
            // æ¯3ç§’æ£€æŸ¥ä¸€æ¬¡éŸ³ä¹çŠ¶æ€ï¼Œå¦‚æœæš‚åœäº†å°±é‡æ–°æ’­æ”¾
            audioKeepAliveInterval = setInterval(() => {
                if (musicPlaying && bgMusic.paused) {
                    console.log('iOSéŸ³é¢‘ä¼‘çœ ï¼Œé‡æ–°å”¤é†’');
                    bgMusic.play().catch(e => {
                        console.log('é‡æ–°æ’­æ”¾å¤±è´¥:', e);
                    });
                }
            }, 3000);
        }

        function stopAudioKeepAlive() {
            if (audioKeepAliveInterval) {
                clearInterval(audioKeepAliveInterval);
            }
        }

        // æ™ºèƒ½è·å–é—®å€™è¯­ï¼ˆä¼˜å…ˆæœªä½¿ç”¨è¿‡çš„ï¼‰
        function getSmartGreeting() {
            // è·å–æœªä½¿ç”¨è¿‡çš„é—®å€™è¯­
            const unusedGreetings = greetings.filter(g => !usedGreetings.includes(g));
            
            if (unusedGreetings.length > 0) {
                const greeting = unusedGreetings[Math.floor(Math.random() * unusedGreetings.length)];
                usedGreetings.push(greeting);
                return greeting;
            } else {
                // æ‰€æœ‰é—®å€™è¯­éƒ½ç”¨è¿‡äº†ï¼Œé‡ç½®å¹¶å¼€å§‹æ–°å¾ªç¯
                greetingCycleCount++;
                usedGreetings = [];
                const greeting = greetings[Math.floor(Math.random() * greetings.length)];
                usedGreetings.push(greeting);
                return greeting;
            }
        }

        // ä¼˜é›…ç§»é™¤æ—§å¼¹çª—
        function removeOldestPopup() {
            if (activePopups.length > 0) {
                const oldestPopup = activePopups.shift(); // ç§»é™¤æœ€æ—©çš„ä¸€ä¸ª
                if (oldestPopup && oldestPopup.parentNode) {
                    oldestPopup.classList.add('fade-out');
                    setTimeout(() => {
                        if (oldestPopup.parentNode) {
                            oldestPopup.parentNode.removeChild(oldestPopup);
                        }
                    }, 400); // æ·¡å‡ºåŠ¨ç”»æ—¶é•¿
                }
            }
        }

        function closeModal() {
            const modal = document.getElementById("modal");
            modal.style.animation = "modalOut 0.3s ease forwards";
            setTimeout(() => {
                modal.style.display = "none";
            }, 300);
        }

        function startExperience() {
            document.getElementById("modal").style.display = "none";
            
            // é‡ç½®çŠ¶æ€
            activePopups = [];
            usedGreetings = [];
            greetingCycleCount = 0;
            musicPlaying = false;
            
            // iOSéŸ³é¢‘ä¿®å¤ï¼šå¼€å§‹æ’­æ”¾éŸ³ä¹
            const playMusic = () => {
                const playPromise = bgMusic.play();
                if (playPromise !== undefined) {
                    playPromise.then(() => {
                        musicPlaying = true;
                        console.log('éŸ³ä¹å¼€å§‹æ’­æ”¾');
                        // å¯åŠ¨iOSéŸ³é¢‘ä¿æ´»
                        startAudioKeepAlive();
                    }).catch(error => {
                        console.log('éŸ³ä¹æ’­æ”¾éœ€è¦ç”¨æˆ·äº¤äº’ï¼Œ2ç§’åé‡è¯•');
                        // 2ç§’åé‡è¯•
                        setTimeout(playMusic, 2000);
                    });
                }
            };
            
            // å»¶è¿Ÿä¸€ç‚¹å¼€å§‹æ’­æ”¾ï¼Œç¡®ä¿é¡µé¢äº¤äº’å®Œæˆ
            setTimeout(playMusic, 100);
            
            experienceStartTime = Date.now();
            createDecorations();
            startPhasedPopups();
            
            // 60ç§’åæ˜¾ç¤ºæœ€ç»ˆæ¶ˆæ¯
            setTimeout(() => {
                showFinalMessage();
                isFinalMessageShown = true;
                if (popupInterval) clearInterval(popupInterval);
                // åœæ­¢éŸ³é¢‘ä¿æ´»
                stopAudioKeepAlive();
            }, 60000);
        }

        function createDecorations() {
            const colors = ['#4a8bff', '#ff4d6d', '#34c759', '#ff9500', '#af52de'];
            
            for (let i = 0; i < 12; i++) {
                const decoration = document.createElement('div');
                decoration.className = 'decoration';
                const size = Math.random() * 100 + 30;
                decoration.style.width = size + 'px';
                decoration.style.height = size + 'px';
                decoration.style.background = colors[Math.floor(Math.random() * colors.length)];
                decoration.style.left = Math.random() * 100 + '%';
                decoration.style.top = Math.random() * 100 + '%';
                document.body.appendChild(decoration);
            }
        }

        function startPhasedPopups() {
            let popupCount = 0;
            let generatedCount = 0;
            
            popupInterval = setInterval(() => {
                if (isFinalMessageShown) {
                    clearInterval(popupInterval);
                    return;
                }
                
                const elapsed = Date.now() - experienceStartTime;
                let batchSize, popupDelay;
                
                // åˆ†æ®µé€Ÿåº¦æ§åˆ¶
                if (elapsed < 20000) {
                    // 0-20ç§’ï¼šèˆ’ç¼“å¯åŠ¨æœŸ
                    batchSize = 1 + Math.floor(Math.random() * 2);
                    popupDelay = 60;
                } else if (elapsed < 40000) {
                    // 20-40ç§’ï¼šæ„‰æ‚¦åŠ é€ŸæœŸ
                    batchSize = 2 + Math.floor(Math.random() * 2);
                    popupDelay = 35;
                } else if (elapsed < 55000) {
                    // 40-55ç§’ï¼šé«˜æ½®ä½“éªŒæœŸ
                    batchSize = 3 + Math.floor(Math.random() * 2);
                    popupDelay = 20;
                } else {
                    // 55-60ç§’ï¼šè‡ªç„¶æ”¶å°¾æœŸ
                    batchSize = 2 + Math.floor(Math.random() * 2);
                    popupDelay = 30;
                }
                
                // æ™ºèƒ½æ¸…ç†ï¼šç”Ÿæˆ2ä¸ªæ–°å¼¹çª—å°±ç§»é™¤1ä¸ªæ—§å¼¹çª—
                if (generatedCount >= 2 && activePopups.length >= MAX_POPUPS) {
                    removeOldestPopup();
                    generatedCount = 0;
                }
                
                // ç”Ÿæˆå¼¹çª—æ‰¹æ¬¡
                for (let i = 0; i < batchSize; i++) {
                    setTimeout(() => {
                        if (!isFinalMessageShown) {
                            createPopup(popupCount++);
                            generatedCount++;
                        }
                    }, i * popupDelay);
                }
            }, 100);
        }

        function createPopup(i) {
            const popup = document.createElement("div");
            const colors = ["pink", "yellow", "blue", "green", "purple", "orange", "cyan", "coral"];
            popup.className = "popup " + colors[Math.floor(Math.random() * colors.length)];
            popup.innerText = getSmartGreeting();
            
            popup.onclick = function() {
                this.style.animation = "popupOut 0.2s ease forwards";
                // ä»æ´»è·ƒåˆ—è¡¨ä¸­ç§»é™¤
                const index = activePopups.indexOf(this);
                if (index > -1) {
                    activePopups.splice(index, 1);
                }
                setTimeout(() => {
                    if (this.parentNode) {
                        this.parentNode.removeChild(this);
                    }
                }, 200);
            };

            document.body.appendChild(popup);
            activePopups.push(popup);

            const maxX = window.innerWidth - 120;
            const maxY = window.innerHeight - 60;
            const x = Math.max(15, Math.min(maxX, Math.random() * maxX));
            const y = Math.max(15, Math.min(maxY, Math.random() * maxY));

            popup.style.left = x + "px";
            popup.style.top = y + "px";
        }

        function showFinalMessage() {
            isFinalMessageShown = true;
            if (popupInterval) clearInterval(popupInterval);
            document.getElementById('final-message').classList.add('show');
        }
    </script>
</body>
</html>
